# tmux.conf
# ì£¼ì˜: ê²½ë¡œ ì„¤ì • ì‹œ ~/ ëŒ€ì‹  $HOME ì‚¬ìš© í•„ìˆ˜ (run-shell ë‚´ì—ì„œ ~ í™•ì¥ ì•ˆë¨)

# ============================================================================
# 1. ê¸°ë³¸ ì„¤ì •
# ============================================================================

# Extended keys (CSI u / Kitty Keyboard Protocol) í™œì„±í™”
# Claude Code ë“± CSI uë¥¼ ì‚¬ìš©í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ì˜ í˜¸í™˜ì„± ê°œì„ 
set -g extended-keys on
set -s extended-keys on
set -g extended-keys-format csi-u
set -as terminal-features 'xterm*:extkeys'

# True color ë° í„°ë¯¸ë„ ì˜¤ë²„ë¼ì´ë“œ
set -ga terminal-overrides ",xterm-256color:Tc"
set -ga terminal-overrides ",xterm-ghostty:Tc"
set -ga terminal-overrides ",tmux-256color:Tc"

# ì°½/pane ì´ë¦„ ìë™ ë³€ê²½ ë¹„í™œì„±í™”
set -g automatic-rename off
set -g allow-rename off

# ë©”ì‹œì§€ í‘œì‹œ ì‹œê°„
set -g display-time 2000

# ì—ë””í„° ì„¤ì •
set-environment -g EDITOR "nvim"

# pane-base-index (base-indexëŠ” Nixì—ì„œ ì„¤ì •, pane-base-indexëŠ” HM ì˜µì…˜ ì—†ìŒ)
setw -g pane-base-index 1

# ìœˆë„ìš° ë²ˆí˜¸ ìë™ ì¬ì •ë ¬
set -g renumber-windows on

# OSC 52 í´ë¦½ë³´ë“œ
set -g set-clipboard on

# ============================================================================
# 2. ë§ˆìš°ìŠ¤ ë° ìŠ¤í¬ë¡¤ ì„¤ì •
# ============================================================================

# ë§ˆìš°ìŠ¤ íœ  ìŠ¤í¬ë¡¤ ìë™í™”
# - ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ ì‚¬ìš© ì•±(vim, less ë“±) ì‹¤í–‰ ì‹œ: í•´ë‹¹ ì•±ì— ì „ë‹¬
# - copy-modeì¼ ë•Œ: ìŠ¤í¬ë¡¤
# - ê·¸ ì™¸: copy-mode ì§„ì… í›„ ìŠ¤í¬ë¡¤
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -X scroll-up' 'copy-mode -e; send-keys -X scroll-up'"
bind -n WheelDownPane select-pane -t= \; send-keys -M

# ============================================================================
# 3. Pane ì„¤ì •
# ============================================================================

# ê²½ê³„ì„  ìŠ¤íƒ€ì¼
set -g pane-border-style fg=cyan,bg=default
set -g pane-active-border-style fg=red,bg=default,bold
set -g pane-border-lines heavy

# Pane ë°°ê²½ìƒ‰ (í™œì„±/ë¹„í™œì„± êµ¬ë¶„)
set -g window-active-style 'fg=terminal,bg=terminal'
set -g window-style 'fg=colour245,bg=default'

# Pane ì œëª© í‘œì‹œ (ìƒë‹¨)
# í‘œì‹œ ì˜ˆì‹œ:
#   [î‚  main]: my-task ğŸ—’ï¸  (Git + ì œëª© + ë…¸íŠ¸)
#   [î‚  main]: my-task      (Git + ì œëª©)
#   [î‚  main]: ğŸš¨pane ì´ë¦„ì„ ì‘ì„±í•´ì£¼ì„¸ìš”  (Git + ì œëª© ë¯¸ì„¤ì •)
#   [ğŸš¨ Git í”„ë¡œì íŠ¸ê°€ ì•„ë‹˜!]: my-task    (Git ì•„ë‹˜)
# ë…¸íŠ¸ ì•„ì´ì½˜(ğŸ—’ï¸): prefix+Nìœ¼ë¡œ ë…¸íŠ¸ ìƒì„± í›„ ë‚´ìš©ì´ ìˆì„ ë•Œ í‘œì‹œ
set -g pane-border-status top
set -g pane-border-format ' #{?pane_active,#[fg=yellow]#[bold],#[fg=cyan]#[bold]}#[fg=yellow]#[bold][#(cd "#{pane_current_path}" && branch=$(git symbolic-ref --short HEAD 2>/dev/null) && echo "î‚  $branch" || echo "ğŸš¨ Git í”„ë¡œì íŠ¸ê°€ ì•„ë‹˜!")]#{?@custom_pane_title,: #[fg=magenta]#[bold]#{@custom_pane_title},: #[fg=magenta]#[dim]ğŸš¨pane ì´ë¦„ì„ ì‘ì„±í•´ì£¼ì„¸ìš”}#[default] #{?@pane_note_path, #[fg=blue]#( [ -s "#{@pane_note_path}" ] && echo " ğŸ—’ï¸"),}'

# ============================================================================
# 4. ìƒíƒœ í‘œì‹œì¤„ ì„¤ì •
# ============================================================================

set -g status-position top
set -g status-style bg=black,fg=white
set -g status-justify left
set -g status-interval 5

# ì™¼ìª½: ì„¸ì…˜ ì´ë¦„
set -g status-left-length 20
set -g status-left '#[fg=cyan,bold]S: #S'

# ì˜¤ë¥¸ìª½: í˜„ì¬ ê²½ë¡œ + Git ë¸Œëœì¹˜
set -g status-right-length 150
set -g status-right '#[fg=cyan,bold]#(sh -c "printf %s \"#{pane_current_path}\" | sed \"s|^$HOME|~|\") #[fg=yellow,bold](#(cd "#{pane_current_path}" && git symbolic-ref --short HEAD 2>/dev/null || echo "")) #[default]'

# ì°½ ëª©ë¡ ìŠ¤íƒ€ì¼
setw -g window-status-format ' #I:#W '
setw -g window-status-current-format '#[fg=black,bg=yellow,bold] #I:#W '

# ============================================================================
# 5. í‚¤ ë°”ì¸ë”©
# ============================================================================

# ì¶©ëŒ ë°©ì§€ë¥¼ ìœ„í•œ unbind
unbind -T prefix n
unbind -T prefix y
unbind -T prefix v
unbind -T prefix u
unbind -T prefix P
unbind -T prefix r
unbind -T prefix N
unbind -T prefix K
unbind -T prefix a
unbind -T prefix T
unbind -T prefix R
unbind -T prefix C
unbind -T prefix F

# ì„¤ì • ë¦¬ë¡œë“œ
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded!"

# ë„ì›€ë§
bind-key -T prefix a run-shell "$HOME/.tmux/scripts/prefix-help.sh"

# ì„¸ì…˜/ì°½ ê´€ë¦¬
bind-key s choose-session -F "#{?session_attached,#[fg=red bold],}#{session_name}: #{session_windows} windows"
bind-key , command-prompt -p "New window name:" "rename-window '%%'"
bind-key $ command-prompt -p "New session name:" "rename-session '%%'"
bind-key P command-prompt -p "Custom pane title:" "set -p @custom_pane_title '%%'; display-message 'Pane title set to %%'"

# ============================================================================
# 6. Pane Notepad ê¸°ëŠ¥
# ============================================================================

set -g @pane_note_sticky 0

# NOTE: pane-focus-in hook ì œê±°ë¨
# tmux-resurrect ë³µì› ì‹œ hookì´ ë¨¼ì € ì‹¤í–‰ë˜ì–´ ë³µì›ëœ ê°’ì„ ë®ì–´ì“°ëŠ” ë¬¸ì œ í•´ê²°
# @pane_note_pathëŠ” ë…¸íŠ¸ ëª…ë ¹ì–´ ì‚¬ìš© ì‹œ ìë™ ì„¤ì •ë¨

# ë…¸íŠ¸ ê´€ë ¨ ë‹¨ì¶•í‚¤
bind-key n run-shell "$HOME/.tmux/scripts/pane-note.sh edit"          # ë…¸íŠ¸ í¸ì§‘
bind-key y run-shell "$HOME/.tmux/scripts/pane-note.sh add-clipboard" # í´ë¦½ë³´ë“œ ì¶”ê°€
bind-key v run-shell "$HOME/.tmux/scripts/pane-note.sh view"          # ì½ê¸° ì „ìš©
bind-key u run-shell "$HOME/.tmux/scripts/pane-note.sh open-url"      # URL ì—´ê¸°

# ë…¸íŠ¸ ê´€ë¦¬ ë‹¨ì¶•í‚¤
bind-key -T prefix N command-prompt -p "New note title:" "run-shell \"$HOME/.tmux/scripts/pane-note.sh new '%%'\""
# Cheat sheet ë¸Œë¼ìš°ì§• (fzf ë¯¸ë¦¬ë³´ê¸°)
bind-key -T prefix C display-popup -E -w 80% -h 80% "$HOME/.tmux/scripts/cheat-browse.sh"

# â˜… fzf ì‚¬ìš© ìŠ¤í¬ë¦½íŠ¸ëŠ” display-popup í•„ìˆ˜ (tty í•„ìš”)
bind-key -T prefix K display-popup -E -w 95% -h 80% "$HOME/.tmux/scripts/pane-link.sh"
bind-key -T prefix T display-popup -E -w 60% -h 50% "$HOME/.tmux/scripts/pane-tag.sh"
bind-key -T prefix R display-popup -E -w 95% -h 80% "$HOME/.tmux/scripts/pane-restore.sh"
