#!/usr/bin/env bash
set -euo pipefail

# í˜„ì¬ pane ì»¨í…ìŠ¤íŠ¸ ì •ë³´(ì˜µì…˜ê°’ì´ ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´)
TITLE="$(tmux display-message -p '#{@custom_pane_title}')"
NOTE_PATH_RAW="$(tmux display-message -p '#{@pane_note_path}')"
NOTE_PATH="$NOTE_PATH_RAW"
[ -n "${NOTE_PATH:-}" ] && NOTE_PATH="$(printf "%s" "$NOTE_PATH" | sed "s|^$HOME|~|")"

# ë³´ê¸°ìš© í…ìŠ¤íŠ¸ ìƒì„±
TMP="$(mktemp -t tmux-help.XXXXXX)"
trap 'rm -f "$TMP"' EXIT

cat >"$TMP" <<EOF
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  Custom tmux Prefix Cheatsheet (prefix + ...)                â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
í˜„ì¬ Pane ì œëª©: ${TITLE:-<ì—†ìŒ>}
í˜„ì¬ ì—°ê²°ëœ ë…¸íŠ¸: ${NOTE_PATH:-<ì—†ìŒ>}

[ì²˜ìŒ ì‹œì‘ (í•„ìˆ˜ 5ê°€ì§€)]
  c : ìƒˆ ì°½ ë§Œë“¤ê¸°
  1-9 : í•´ë‹¹ ë²ˆí˜¸ ì°½ìœ¼ë¡œ ì´ë™
  d : tmuxì—ì„œ ë‚˜ê°€ê¸° (ì„¸ì…˜ ìœ ì§€, SSH ì¬ì ‘ì† ì‹œ ìë™ ë³µê·€)
  Ctrl-s : ì„¸ì…˜ ì €ì¥
  Ctrl-r : ì„¸ì…˜ ë³µì›

[í…ìŠ¤íŠ¸ ë³µì‚¬]
  F : í™”ë©´ì—ì„œ URL/ê²½ë¡œ/í•´ì‹œ ë“±ì„ íŒíŠ¸ë¡œ ë³µì‚¬ (tmux-thumbs)
      â†’ ë³µì‚¬ í›„ prefix + ] ë¡œ ë¶™ì—¬ë„£ê¸°

[ì¹˜íŠ¸ì‹œíŠ¸]
  C : ì¹˜íŠ¸ì‹œíŠ¸ ë¸Œë¼ìš°ì§• (cheat + fzf)

[ë…¸íŠ¸ ê´€ë ¨]
  N : ìƒˆ ë…¸íŠ¸ ìƒì„± (ì œëª© â†’ íƒœê·¸ ì„ íƒ)
  K : ê¸°ì¡´ ë…¸íŠ¸ ì—°ê²° (fzf)
  T : íƒœê·¸ ìˆ˜ì • (í˜„ì¬ ë…¸íŠ¸)
  n : ë…¸íŠ¸ í¸ì§‘ (íŒì—…) â€” ë§í¬ ì—†ìœ¼ë©´ ì•ˆë‚´
  v : ë…¸íŠ¸ ì½ê¸° (ì½ê¸° ì „ìš© íŒì—…)
  y : í´ë¦½ë³´ë“œ í•œ ì¤„ì„ ë…¸íŠ¸ì— ì¶”ê°€
  u : ë…¸íŠ¸ ë‚´ URL ë©”ë‰´ ì—´ê¸° (ë¼ë²¨/ë„ë©”ì¸ë³„)

[fzf ë‚´ë¶€ ë‹¨ì¶•í‚¤ (K, Vì—ì„œ)]
  ctrl-p : í˜„ì¬ í”„ë¡œì íŠ¸ë§Œ í•„í„°
  ctrl-a : ì „ì²´ í‘œì‹œ
  ctrl-d : ì‚­ì œ (_trashë¡œ ì´ë™)
  ctrl-x : ì•„ì¹´ì´ë¸Œ (_archiveë¡œ ì´ë™)

[ì´ë¦„/ì„¸ì…˜ ê´€ë¦¬]
  P : í˜„ì¬ pane ì‚¬ìš©ì ì§€ì • ì œëª©(@custom_pane_title) ì„¤ì •
  , : í˜„ì¬ ì°½ ì´ë¦„ ë³€ê²½
  $ : í˜„ì¬ ì„¸ì…˜ ì´ë¦„ ë³€ê²½
  s : ì„¸ì…˜ ì„ íƒ ë©”ë‰´

[ì„¤ì •]
  r : tmux ì„¤ì • ë¦¬ë¡œë“œ (source-file ~/.config/tmux/tmux.conf)

[ì„¸ì…˜ ì €ì¥/ë³µì› (tmux-resurrect)]
  Ctrl-s : ì„¸ì…˜ ì €ì¥ (pane ë³€ìˆ˜ í¬í•¨)
  Ctrl-r : ì„¸ì…˜ ë³µì›

Tip
- prefix + :  â†’ tmux ëª…ë ¹ í”„ë¡¬í”„íŠ¸
- í˜„ì¬ paneì˜ ë…¸íŠ¸ ê²½ë¡œ í™•ì¸:  tmux display-message -p '#{@pane_note_path}'
- ë…¸íŠ¸ ì•„ì´ì½˜(ğŸ—’ï¸)ì€ ë§í¬ëœ ê²½ë¡œê°€ ì¡´ì¬í•˜ê³  íŒŒì¼ í¬ê¸°ê°€ 0ë³´ë‹¤ í´ ë•Œ í‘œì‹œë¨
- ë…¸íŠ¸ í´ë” êµ¬ì¡°: ~/.tmux/pane-notes/{repo}/{title}.md
EOF

# íŒì—…ìœ¼ë¡œ ë³´ê¸°: batì´ ìˆìœ¼ë©´ bat, ì—†ìœ¼ë©´ less
if command -v bat >/dev/null 2>&1; then
  tmux display-popup -E -w 85% -h 75% "bat -pp --paging=always '$TMP'"
else
  tmux display-popup -E -w 85% -h 75% "LESS= less -+F -+X -R '$TMP'"
fi
